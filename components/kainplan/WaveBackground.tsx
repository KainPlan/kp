import React from 'react';
import anime from 'animejs';
import style from './WaveBackground.module.scss';

export enum WaveBackgroundPosition {
  TOP, BOTTOM
}

interface WaveBackgroundProps {
  position: WaveBackgroundPosition;
  animated?: boolean;
  color?: string;
  background?: string;
}

interface WaveBackgroundState {
  width: number;
  height: number;
  color?: string;
  background?: string;
}

class WaveBackground extends React.Component<WaveBackgroundProps, WaveBackgroundState> {
  private static waves: {
    [ id in WaveBackgroundPosition ]: string[];
  } = {
    0: [
      `M0,64L48,96C96,128,192,192,288,197.3C384,203,480,149,576,149.3C672,149,768,203,864,192C960,181,1056,107,1152,106.7C1248,107,1344,181,1392,218.7L1440,256L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z`,
      `M0,96L48,96C96,96,192,96,288,122.7C384,149,480,203,576,192C672,181,768,107,864,85.3C960,64,1056,96,1152,138.7C1248,181,1344,235,1392,261.3L1440,288L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z`,
      `M0,288L48,293.3C96,299,192,309,288,314.7C384,320,480,320,576,266.7C672,213,768,107,864,64C960,21,1056,43,1152,74.7C1248,107,1344,149,1392,170.7L1440,192L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z`,
      `M0,64L48,85.3C96,107,192,149,288,165.3C384,181,480,171,576,160C672,149,768,139,864,128C960,117,1056,107,1152,128C1248,149,1344,203,1392,229.3L1440,256L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z`,
      `M0,192L48,202.7C96,213,192,235,288,245.3C384,256,480,256,576,213.3C672,171,768,85,864,58.7C960,32,1056,64,1152,80C1248,96,1344,96,1392,96L1440,96L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z`,
      `M0,96L48,90.7C96,85,192,75,288,85.3C384,96,480,128,576,128C672,128,768,96,864,85.3C960,75,1056,85,1152,90.7C1248,96,1344,96,1392,96L1440,96L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z`,
      `M0,192L48,202.7C96,213,192,235,288,250.7C384,267,480,277,576,261.3C672,245,768,203,864,197.3C960,192,1056,224,1152,250.7C1248,277,1344,299,1392,309.3L1440,320L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z`,
      `M0,128L48,154.7C96,181,192,235,288,240C384,245,480,203,576,208C672,213,768,267,864,288C960,309,1056,299,1152,277.3C1248,256,1344,224,1392,208L1440,192L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z`,
    ],
    1: [
      `M0,32L48,42.7C96,53,192,75,288,117.3C384,160,480,224,576,229.3C672,235,768,181,864,181.3C960,181,1056,235,1152,245.3C1248,256,1344,224,1392,208L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z`,
      `M0,192L48,170.7C96,149,192,107,288,106.7C384,107,480,149,576,149.3C672,149,768,107,864,96C960,85,1056,107,1152,149.3C1248,192,1344,256,1392,288L1440,320L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z`,
      `M0,128L48,144C96,160,192,192,288,218.7C384,245,480,267,576,266.7C672,267,768,245,864,229.3C960,213,1056,203,1152,197.3C1248,192,1344,192,1392,192L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z`,
      `M0,192L48,186.7C96,181,192,171,288,181.3C384,192,480,224,576,213.3C672,203,768,149,864,138.7C960,128,1056,160,1152,181.3C1248,203,1344,213,1392,218.7L1440,224L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z`,
      `M0,288L48,256C96,224,192,160,288,128C384,96,480,96,576,122.7C672,149,768,203,864,197.3C960,192,1056,128,1152,122.7C1248,117,1344,171,1392,197.3L1440,224L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z`,
      `M0,224L48,224C96,224,192,224,288,202.7C384,181,480,139,576,117.3C672,96,768,96,864,90.7C960,85,1056,75,1152,85.3C1248,96,1344,128,1392,144L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z`,
      `M0,32L48,80C96,128,192,224,288,250.7C384,277,480,235,576,234.7C672,235,768,277,864,272C960,267,1056,213,1152,208C1248,203,1344,245,1392,266.7L1440,288L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z`,
      `M0,160L48,170.7C96,181,192,203,288,213.3C384,224,480,224,576,213.3C672,203,768,181,864,192C960,203,1056,245,1152,234.7C1248,224,1344,160,1392,128L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z`,
    ],
  };

  private waveSvg: SVGElement;
  private wavePath: SVGPathElement;
  private resizeWrapper: () => void = () => this.onResize();

  constructor(props) {
    super(props);
    this.state = {
      width: 0,
      height: 0,
      color: props.color || '#622dff',
      background: props.background || 'rgba(0,0,0,0)',
    };
  }

  componentDidMount() {
    window.addEventListener('resize', this.resizeWrapper);
    this.onResize();
    if (this.props.animated) {
      anime({
        targets: this.wavePath,
        d: WaveBackground.waves[this.props.position],
        duration: 20000,
        easing: 'easeInOutSine',
        loop: true,
        direction: 'alternate',
        autoplay: true,
      });
    }
  }

  componentWillUnmount() {
    window.removeEventListener('resize', this.resizeWrapper);
  }

  onResize() {
    this.setState({
      width: window.innerWidth,
      height: window.innerHeight,
    });
  }

  render() {
    return (
      <div className={style.root} style={{
        backgroundColor: this.state.color,
        height: `${this.state.height / 2 - (this.waveSvg ? this.waveSvg.getBoundingClientRect().height/2 : 0) + 1}px`,
        top: this.props.position === WaveBackgroundPosition.TOP ? '0' : 'unset',
        bottom: this.props.position === WaveBackgroundPosition.BOTTOM ? '0' : 'unset',
      }}>
        <svg ref={e => this.waveSvg = e} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
          <path 
            ref={e => this.wavePath = e} 
            fill={this.state.color} 
            fillOpacity="1" 
            d={WaveBackground.waves[this.props.position][Math.floor(Math.random()*WaveBackground.waves[this.props.position].length)]}
          ></path>
        </svg>
      </div>
    );
  }
}

export default WaveBackground;